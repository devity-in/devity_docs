# Spec Schema Definition

This document defines the structure and rules for the JSON format used to represent Devity Specs. This JSON is generated by the Backend, published to the CDN, and consumed by the Client SDKs.

## 1. Top-Level Structure

The root of a Devity Spec JSON object contains metadata and the main workflow definition.

```json
{
  "specVersion": "1.0.0",       // Semantic version of the spec format itself
  "specId": "onboarding_v2",    // Unique identifier for this specific spec
  "version": 3,                 // Internal version number of this spec content
  "createdAt": "2024-07-28T10:00:00Z", // ISO 8601 timestamp
  "entryPoint": "screen_welcome", // ID of the initial screen to load
  "globalData": { ... },       // Optional: Data available throughout the spec
  "screens": {
    "screen_welcome": { ... },  // Definition for the 'welcome' screen
    "screen_details": { ... }   // Definition for the 'details' screen
    // ... other screens
  },
  "actions": {
    "action_submit": { ... },   // Definition for a 'submit' action
    "action_navigate_details": { ... }
    // ... other reusable actions
  },
  "rules": {
    "rule_enable_submit": { ... } // Definition for a rule
    // ... other rules
  }
}
```

- **`specVersion` (String, Required):** Specifies the version of the schema this spec adheres to. Ensures SDK compatibility.
- **`specId` (String, Required):** A unique identifier for this particular workflow/spec (e.g., `user_profile`, `product_listing_v3`). Managed via the Console.
- **`version` (Integer, Required):** An incremental version number for the _content_ of this specific `specId`. Managed by the backend publishing process.
- **`createdAt` (String, Required):** ISO 8601 timestamp indicating when this version was published.
- **`entryPoint` (String, Required):** The `id` of the screen object within the `screens` map that should be displayed first when the spec is loaded.
- **`globalData` (Object, Optional):** A container for data that can be accessed from anywhere within the spec (e.g., configuration, user info loaded initially).
- **`screens` (Object<Screen>, Required):** A map where keys are unique screen IDs (strings) and values are [Screen Objects](#2-screen-object).
- **`actions` (Object<Action>, Optional):** A map where keys are unique action IDs (strings) and values are [Action Objects](#5-action-object). Allows defining reusable actions.
- **`rules` (Object<Rule>, Optional):** A map where keys are unique rule IDs (strings) and values are [Rule Objects](#6-rule-object).

## 2. Screen Object

Defines a single screen within the workflow.

```json
{
  "id": "screen_welcome",        // String, Required: Unique identifier for this screen within the spec.
  "type": "Screen",             // String, Required: Must be "Screen".
  "backgroundColor": "#FFFFFF", // String, Optional: Screen background color (Hex format, e.g., #RRGGBB, #AARRGGBB).
  "appBar": { ... },          // Object<Widget>, Optional: Definition for the screen's AppBar. Typically a custom AppBar widget or a Row/Stack renderer.
  "body": { ... },            // Object<Renderer|Widget>, Required: Root Renderer or Widget for the screen content.
  "bottomNavBar": { ... },    // Object<Widget>, Optional: Definition for a bottom navigation bar. Typically a custom widget or Row renderer.
  "onLoadActions": [ ... ],   // Array<String>, Optional: Action IDs triggered sequentially when screen initially loads and becomes visible.
  "persistentData": { ... }   // Object, Optional: Data store specific to this screen instance, potentially accessible via `{{state.screenData...}}`. Values might be updated via `SetData` actions targeting this scope.
}
```

- **`id` (String, Required):** Unique identifier for this screen within the Spec.
- **`type` (String, Required):** Must always be `"Screen"`.
- **`backgroundColor` (String, Optional):** Background color for the screen area. Supports Hex format (e.g., `"#FFFFFF"`, `"#80FF0000"`).
- **`appBar` (Object<Widget|Renderer>, Optional):** A standard Widget or Renderer object defining the AppBar.
- **`body` (Object<Widget|Renderer>, Required):** The main content of the screen. Must be a single Widget or Renderer object.
- **`bottomNavBar` (Object<Widget|Renderer>, Optional):** A standard Widget or Renderer object defining the bottom navigation area.
- **`onLoadActions` (Array<String>, Optional):** An array of action IDs (strings) to be executed sequentially when the screen is first loaded.
- **`persistentData` (Object, Optional):** A key-value store for data associated with this screen instance.

## 3. Renderer Object

Defines a layout component that arranges child components.

```json
{
  "id": "main_column",        // String, Optional: Unique identifier for referencing this renderer (e.g., from rules).
  "type": "Renderer",         // String, Required: Must be "Renderer".
  "rendererType": "Column",   // String, Required: Specifies the type of layout (e.g., "Column", "Row", "Stack", "Scrollable", "Padding").
  "attributes": { ... },      // Object, Optional: Attributes specific to the `rendererType` (e.g., alignment, spacing).
  "children": [ ... ],      // Array<Object<Renderer|Widget>>, Optional: Child components to be laid out by this renderer.
  "style": { ... }          // Object<Style>, Optional: Common style properties (See [Styling Properties](#9-styling-properties)).
}
```

- **`id` (String, Optional):** Optional identifier.
- **`type` (String, Required):** Must always be `"Renderer"`.
- **`rendererType` (String, Required):** Determines the layout behavior. Initial supported types:
  - `"Column"`: Arranges children vertically. Attributes might include `mainAxisAlignment`, `crossAxisAlignment`, `spacing`.
  - `"Row"`: Arranges children horizontally. Attributes might include `mainAxisAlignment`, `crossAxisAlignment`, `spacing`.
  - `"Stack"`: Layers children. Children might have positioning attributes.
  - `"Scrollable"`: Makes its single child scrollable. Requires exactly one `child`. Attributes: `scrollDirection` (String, Optional: `"vertical"` (default) or `"horizontal"`).
  - `"Padding"`: Applies padding around its single child. Requires exactly one `child`. Attributes: `padding` (Object<PaddingValue>, Required - See [Padding Value](#91-padding-value)). Note: This padding overrides any padding defined in the `style` object of this renderer.
- **`attributes` (Object, Optional):** Key-value pairs specific to the `rendererType`.
- **`children` (Array<Object<Renderer|Widget>>, Optional):** An array of child Renderer or Widget objects. Required for `Column`, `Row`, `Stack`. Exactly one required for `Scrollable` and `Padding`.
- **`style` (Object<Style>, Optional):** Common visual styles. See [Styling Properties](#9-styling-properties).

See [Component Reference: Renderers](../components/renderers/) for details on each `rendererType`.

## 4. Widget Object

Defines a specific UI element.

```json
{
  "id": "welcome_text",      // String, Required: Unique identifier for this widget within the spec. Needed for rules, state updates, data binding (`widget.<id>`).
  "type": "Widget",           // String, Required: Must be "Widget".
  "widgetType": "Text",       // String, Required: Specifies the type of UI element (e.g., "Text", "Button", "Image", "TextField").
  "attributes": { ... },      // Object, Required: Properties specific to the `widgetType` (content, behavior). Values can be static or use data binding.
  "style": { ... },         // Object<Style>, Optional: Common style properties.
  "onClickActionIds": [ ... ], // Array<String>, Optional: Action IDs triggered on tap.
  "onValueChangedActionIds": [ ... ], // Array<String>, Optional: Action IDs triggered when the widget's primary value changes (e.g., TextField input, Slider position).
  // ... other potential event hooks like onSubmitActionIds, etc.
}
```

- **`id` (String, Required):** Unique identifier for the widget.
- **`type` (String, Required):** Must always be `"Widget"`.
- **`widgetType` (String, Required):** Determines the UI element. Initial supported types:
  - `"Text"`: Displays text. Attributes: `text` (String|Binding), `fontSize` (Number|Binding), `fontWeight` (String|Binding), `color` (String|Binding), `textAlign` (String), `maxLines` (Number).
  - `"Button"`: Clickable button. Attributes: `text` (String|Binding, Required), `enabled` (Boolean|Binding, default: `true`). Uses `onClickActionIds` for interactivity.
  - `"Image"`: Displays an image. Attributes: `url` (String|Binding), `fit` (String, e.g., `"cover"`), `width` (Number|Binding), `height` (Number|Binding).
  - `"TextField"`: Text input field. Attributes: `placeholder` (String|Binding), `initialValue` (String|Binding), `keyboardType` (String), `obscureText` (Boolean|Binding, default: `false`), `value` (Binding - _read-only reference for data binding/rules_). Uses `onValueChangedActionIds`.
- **`attributes` (Object, Required):** Key-value pairs specific to the `widgetType`. Values can be literals or use [Data Binding Syntax](#7-data-binding-syntax).
- **`style` (Object<Style>, Optional):** Common visual styles. See [Styling Properties](#9-styling-properties).
- **`onClickActionIds` (Array<String>, Optional):** Action IDs executed on tap. Primarily used by `Button`.
- **`onValueChangedActionIds` (Array<String>, Optional):** Action IDs executed when the widget's value changes (relevant for input widgets like `TextField`).

See [Component Reference: Widgets](../components/widgets/) for details on each `widgetType`.

## 5. Action Object

Defines an operation to be executed.

```json
{
  "id": "action_navigate_details", // String, Required: Unique identifier for this action.
  "type": "Action",               // String, Required: Must be "Action".
  "actionType": "Navigate",       // String, Required: Specifies the operation (e.g., "Navigate", "ApiCall", "ShowAlert", "UpdateWidgetState", "SetData").
  "attributes": { ... }         // Object, Optional: Parameters specific to the `actionType`. Values can be static or use data binding.
}
```

- **`id` (String, Required):** Unique identifier for the action.
- **`type` (String, Required):** Must always be `"Action"`.
- **`actionType` (String, Required):** Determines the operation. Initial supported types:
  - `"Navigate"`: Changes screen. Attributes: `targetScreenId` (String|Binding, required), `transitionType` (String), `clearHistory` (Boolean), `screenData` (Object|Binding).
  - `"ApiCall"`: Makes network request. Attributes: `url` (String|Binding, required), `method` (String, e.g., `"GET"`, `"POST"`, required), `headers` (Object|Binding), `body` (Object|String|Binding), `onSuccessActionIds` (Array<String>), `onFailureActionIds` (Array<String>).
  - `"ShowAlert"`: Displays a message. Attributes: `title` (String|Binding), `message` (String|Binding, required), `buttonText` (String|Binding).
  - `"UpdateWidgetState"`: Modifies another widget. Attributes: `targetWidgetId` (String|Binding, required), `newState` (Object|Binding, required - map of attributes/style to update).
  - `"SetData"`: Updates state data. Attributes: `scope` (String, e.g., `"global"`, `"screen"`, `"widget"`, default: `"screen"`), `targetId` (String|Binding, required if scope is `"widget"`), `data` (Object|Binding, required - data to merge into the target scope).
- **`attributes` (Object, Optional):** Key-value pairs specific to the `actionType`. Values can be literals or use [Data Binding Syntax](#7-data-binding-syntax).

See [Component Reference: Actions](../components/actions/) for details on each `actionType`.

## 6. Rule Object

Defines logic for inter-widget communication.

```json
{
  "id": "rule_enable_submit",
  "type": "Rule",
  "trigger": { ... }, // Defines what triggers the rule check (e.g., widget value change)
  "condition": { ... }, // Expression object that must evaluate to true
  "actionIds": ["action_enable_button"] // Action IDs executed if condition is true
}
```

_(Details of Rule properties, trigger types, and condition structure to be defined here)_

## 7. Data Binding Syntax

_(Define the syntax used within attribute values to bind to dynamic data sources, e.g., `{{api.user.name}}`, `{{widget.email_input.value}}`, `{{state.cartTotal}}`)_

## 8. Expression Syntax

_(Define the syntax and supported operators/functions for expressions used in conditions and potentially for computed attribute values)_

## 9. Styling Properties

The optional `style` object can be added to Renderer and Widget objects to control common visual appearance.

```json
{
  "style": {
    "backgroundColor": "#FF000080", // Optional: String, Hex format (#RRGGBB or #AARRGGBB)
    "textColor": "#000000",       // Optional: String, Hex format (#RRGGBB or #AARRGGBB). Primarily affects Text widget content.
    "padding": { ... }           // Optional: Object<PaddingValue>, defines padding inside the component's bounds.
    // ... other common style properties like margin, border, cornerRadius to be added later.
  }
}
```

- **`backgroundColor` (String, Optional):** Sets the background color of the component's area.
- **`textColor` (String, Optional):** Sets the default text color. Primarily used by the `Text` widget, but could influence defaults in complex widgets.
- **`padding` (Object<PaddingValue>, Optional):** Defines space between the component's border and its content/children. See [Padding Value](#91-padding-value).

### 9.1 Padding Value

Defines padding for edges. All values are numbers representing logical pixels/points.

```json
{
  "top": 8, // Optional: Number, defaults to 0
  "bottom": 8, // Optional: Number, defaults to 0
  "left": 16, // Optional: Number, defaults to 0
  "right": 16 // Optional: Number, defaults to 0
}
```

Or a single number for uniform padding on all sides:

```json
{
  "all": 10 // Optional: Number, applies to top, bottom, left, right if they are not specified.
}
```

---

_(This is an initial outline. Each section needs significant elaboration as the design is finalized.)_
